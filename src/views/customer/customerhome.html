<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home</title>
  <link rel="stylesheet" href="/navbar2.css" />
  <link rel="stylesheet" href="/customer/customerHome.css">
  <link rel="stylesheet" href="/footer.css" />
  <link rel="stylesheet" href="/customer/homePageStatusTab.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    .card {
      position: relative;
      cursor: pointer;
      border-left: 4px solid #5c4033;
    }

    .order-products-list {
      list-style: none;
      margin: 0;
      padding: 0;
      max-height: 250px;
      overflow-y: auto;
      scrollbar-width: thin;
    }

    .order-products-list::-webkit-scrollbar {
      width: 5px;
    }

    .order-products-list::-webkit-scrollbar-thumb {
      background-color: rgba(92, 64, 51, 0.3);
      border-radius: 10px;
    }

    .product-item {
      display: flex;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #f0f0f0;
      transition: background-color 0.2s;
    }

    .product-item:last-child {
      border-bottom: none;
    }

    .product-item:hover {
      background-color: #f9f7f5;
    }

    .product-image {
      width: 60px;
      height: 60px;
      border-radius: 6px;
      overflow: hidden;
      margin-right: 12px;
      border: 1px solid #eee;
    }

    .product-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .product-details {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .product-details strong {
      display: block;
      font-size: 0.9rem;
      color: #333;
      margin-bottom: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 180px;
    }

    .quantity {
      font-size: 0.85rem;
      color: #666;
      padding: 2px 6px;
      background-color: #f3f3f3;
      border-radius: 12px;
      display: inline-block;
    }

    .price {
      font-weight: 600;
      color: #5c4033;
      margin-left: auto;
      font-size: 0.95rem;
    }

    .order-summary {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px dashed #e0e0e0;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .order-status-info {
      background-color: #f8f5f2;
      padding: 10px;
      border-radius: 6px;
      text-align: center;
      font-size: 0.9rem;
    }

    .card-header {
      background-color: #f8f5f2;
    }

    .card-header h3 {
      font-size: 1.1rem;
      color: #5c4033;
    }

    .order-actions {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }

    .btn.primary {
      background-color: #5c4033;
      border-color: #5c4033;
    }

    .btn.primary:hover {
      background-color: #4a3328;
    }

    .btn.outline {
      background-color: transparent;
      border: 1px solid #5c4033;
      color: #5c4033;
    }

    .btn.outline:hover {
      background-color: #f8f5f2;
    }

    .status {
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status.pending {
      background-color: #fff3c5;
      color: #92400e;
    }

    .status.accepted,
    .status.delivered {
      background-color: #dcfce7;
      color: #166534;
    }

    .status.processing {
      background-color: #e0f2fe;
      color: #0369a1;
    }

    .status.shipped {
      background-color: #e0e7ff;
      color: #4338ca;
    }

    .status.cancelled {
      background-color: #fee2e2;
      color: #b91c1c;
    }

    .order-date {
      display: flex;
      align-items: center;
      color: #666;
      font-size: 0.85rem;
    }

    .order-date i {
      margin-right: 5px;
      color: #5c4033;
    }

    .order-total {
      font-weight: bold;
      font-size: 1rem;
    }

    .card-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background-color: #5c4033;
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
  </style>
</head>

<body>
  <div id="navbar"></div>

  <main>
    <div class="mainimage">
      <h3>We Make Things With love</h3>
      <h1>HANDMADE</h1>
      <p>
        Lorem ipsum, dolor sit amet consectetur adipisicing elit. Sapiente
        eligendi repudiandae vero quis? Nostrum provident repellendus alias
        incidunt, perferendis aut blanditiis dicta nisi, magni enim sint
        magnam quidem eius temporibus maxime facere?
      </p>
    </div>
    <div class="seconelem">
      <img src="/images/landingpage/artisan.jpg" alt="" srcset="" />
      <div class="welcomecontent">
        <h1>Welcome To ArtisanSpace</h1>
        <p>
          It is a long established fact that a reader will be distracted by
          the readable content of a page when looking at its layout. The point
          of using Lorem Ipsum is that it has a more-or-less normal
          distribution of letters, as opposed to using 'Content here, content
          here', making it look like readable English. Many desktop publishing
          packages and web page editors now use Lorem Ipsum as their default
          model text, and a search for 'lorem ipsum' will uncover.
        </p>
      </div>
    </div>
    <div class="slider-container">
      <div class="slider"></div>
    </div>
    <!-- // new tabs -->

    <div class="statusTab">

      <div class="tabs">
        <button class="tab-btn active" data-tab="orders"><i class="fas fa-box"></i> Orders</button>
        <button class="tab-btn" data-tab="requests"><i class="fas fa-palette"></i> Custom Requests</button>
        <button class="tab-btn" data-tab="workshops"><i class="fas fa-chalkboard-teacher"></i> Workshops</button>
      </div>

      <div class="tab-content active" id="orders">
        <h2><i class="fas fa-shopping-bag"></i> Your Orders</h2>
        <div class="cards-container" id="orders-container">
          <!-- Orders will be loaded here -->
        </div>
      </div>

      <div class="tab-content" id="requests">
        <h2><i class="fas fa-palette"></i> Your Custom Requests</h2>
        <div class="cards-container" id="requests-container">
          <!-- Requests will be loaded here -->
        </div>
      </div>

      <div class="tab-content" id="workshops">
        <h2><i class="fas fa-chalkboard-teacher"></i> Your Workshops</h2>
        <div class="cards-container" id="workshops-container">
          <!-- Workshops will be loaded here -->
        </div>
      </div>
    </div>
  </main>
  <div id="footer"></div>
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      // Fetch and load navbar
      try {
        const navbarResponse = await fetch('/customer/partials/navbar2');
        const navbarHtml = await navbarResponse.text();
        document.getElementById('navbar').innerHTML = navbarHtml;
      } catch (error) {
        console.error('Error loading navbar:', error);
      }

      // Fetch and load footer
      try {
        const footerResponse = await fetch('/customer/partials/footer');
        const footerHtml = await footerResponse.text();
        document.getElementById('footer').innerHTML = footerHtml;
      } catch (error) {
        console.error('Error loading footer:', error);
      }

      // Fetch orders
      try {
        const ordersResponse = await fetch('/customer/api/orders');
        const orders = await ordersResponse.json();
        renderOrders(orders);
      } catch (error) {
        console.error('Error fetching orders:', error);
      }

      // Fetch requests
      try {
        const requestsResponse = await fetch('/customer/api/requests');
        const requests = await requestsResponse.json();
        renderRequests(requests);
      } catch (error) {
        console.error('Error fetching requests:', error);
      }

      // Fetch workshops
      try {
        const workshopsResponse = await fetch('/customer/api/workshops');
        const workshops = await workshopsResponse.json();
        renderWorkshops(workshops);
      } catch (error) {
        console.error('Error fetching workshops:', error);
      }

      // Make cards clickable except when clicking on action buttons
      document.addEventListener("click", (event) => {
        const card = event.target.closest('.card');
        if (card && !event.target.closest('button')) {
          const orderId = card.getAttribute("data-id");
          if (orderId) {
            window.location.href = `/customer/orders/${orderId}`;
          }
        }
      });

      // Dynamically load slider products
      const slider = document.querySelector(".slider");
      try {
        const productsResponse = await fetch("/customer/api/products");
        const products = await productsResponse.json();
        slider.innerHTML = "";
        products.forEach(product => {
          const a = document.createElement('a');
          a.href = `/products/${product._id}`;
          const img = document.createElement('img');
          img.src = product.image;
          img.alt = product.name;
          a.appendChild(img);
          slider.appendChild(a);
        });
      } catch (error) {
        console.error('Error fetching products:', error);
      }

      function moveSlider() {
        const firstImage = slider.firstElementChild;
        if (!firstImage) return;
        const imgWidth = firstImage.offsetWidth + 20;
        slider.style.transition = "transform 0.7s ease-in-out";
        slider.style.transform = `translateX(-${imgWidth}px)`;
        setTimeout(() => {
          slider.appendChild(firstImage);
          slider.style.transition = "none";
          slider.style.transform = "translateX(0)";
        }, 700);
      }
      setInterval(moveSlider, 4000);
    });

    function renderOrders(orders) {
      const container = document.getElementById('orders-container');
      if (orders && orders.length > 0) {
        container.innerHTML = orders.map((order, index) => `
          <div class="card" data-id="${order._id}">
            ${index === 0 ? '<div class="card-badge"><i class="fas fa-star"></i></div>' : ''}
            <div class="card-header">
              <h3><i class="fas fa-receipt"></i> Order #${order._id.slice(-6).toUpperCase()}</h3>
              <span class="status ${order.status.toLowerCase()}">${order.status}</span>
            </div>
            <div class="card-body">
              <p><strong><i class="fas fa-box-open"></i> Products:</strong></p>
              <ul class="order-products-list">
                ${order.products.map(product => `
                  <li>
                    <div class="product-item">
                      <div class="product-image">
                        <img src="${product.productId.image}" alt="${product.productId.name}">
                      </div>
                      <div class="product-details">
                        <strong>${product.productId.name}</strong>
                        <span class="quantity">x${product.quantity}</span>
                        <span class="price">₹${(product.productId.newPrice * product.quantity).toFixed(2)}</span>
                      </div>
                    </div>
                  </li>
                `).join('')}
              </ul>
              <div class="order-summary">
                <p class="order-date"><i class="far fa-calendar-alt"></i> ${new Date(order.purchasedAt).toLocaleDateString('en-IN', {day: 'numeric', month: 'short', year: 'numeric'})}</p>
                <p class="order-total"><i class="fas fa-rupee-sign"></i> ${order.money.toFixed(2)}</p>
              </div>
            </div>
            <div class="card-footer">
              ${order.status === 'delivered' ? `
                <div class="order-actions">
                  <button class="btn outline" onclick="window.location.href='/customer/orders/${order._id}'">
                    <i class="fas fa-eye"></i> View Details
                  </button>
                </div>
              ` : `
                <div class="order-status-info">
                  ${order.status === 'pending' ? '<i class="fas fa-clock"></i> Your order is waiting to be processed' :
                    order.status === 'processing' ? '<i class="fas fa-cog fa-spin"></i> Your order is being processed' :
                    order.status === 'shipped' ? '<i class="fas fa-truck"></i> Your order is on the way' : ''}
                </div>
                <button class="btn outline" onclick="window.location.href='/customer/orders/${order._id}'">
                  <i class="fas fa-eye"></i> View Details
                </button>
              `}
            </div>
          </div>
        `).join('');
      } else {
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-shopping-basket" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
            <p>You don't have any orders yet.</p>
            <a href="/customer/store"><button class="btn primary"><i class="fas fa-store"></i> Shop Now</button></a>
          </div>
        `;
      }
    }

    function renderRequests(requests) {
      const container = document.getElementById('requests-container');
      if (requests && requests.length > 0) {
        container.innerHTML = requests.map(request => `
          <div class="card">
            <div class="card-header">
              <h3><i class="fas fa-paint-brush"></i> ${request.title}</h3>
              <span class="status ${request.isAccepted ? 'accepted' : 'pending'}">
                ${request.isAccepted ? 'Accepted' : 'Pending'}
              </span>
            </div>
            ${request.image ? `<div class="card-image"><img src="${request.image}" alt="${request.title}"></div>` : ''}
            <div class="card-body">
              <p><strong><i class="fas fa-tag"></i> Type:</strong> ${request.type}</p>
              <p><strong><i class="fas fa-align-left"></i> Description:</strong> ${request.description}</p>
              <p><strong><i class="fas fa-rupee-sign"></i> Budget:</strong> ${request.budget}</p>
              <p><strong><i class="fas fa-calendar-check"></i> Required By:</strong> ${request.requiredBy}</p>
            </div>
            <div class="card-footer">
              <!-- No actions currently defined -->
            </div>
          </div>
        `).join('');
      } else {
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-paint-brush" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
            <p>You don't have any custom requests yet.</p>
            <a href="/customer/customorder"><button class="btn primary"><i class="fas fa-plus-circle"></i> Create Request</button></a>
          </div>
        `;
      }
    }

    function renderWorkshops(workshops) {
      const container = document.getElementById('workshops-container');
      if (workshops && workshops.length > 0) {
        container.innerHTML = workshops.map(workshop => `
          <div class="card">
            <div class="card-header">
              <h3><i class="fas fa-graduation-cap"></i> ${workshop.workshopTitle}</h3>
              <span class="status ${workshop.status === 1 ? 'accepted' : 'pending'}">
                ${workshop.status === 1 ? 'Accepted' : 'Pending'}
              </span>
            </div>
            <div class="card-body">
              <p><strong><i class="fas fa-align-left"></i> Description:</strong> ${workshop.workshopDescription}</p>
              <p><strong><i class="fas fa-calendar-day"></i> Date:</strong> ${workshop.date}</p>
              <p><strong><i class="fas fa-clock"></i> Time:</strong> ${workshop.time}</p>
              ${workshop.status === 1 && workshop.acceptedAt ? `<p><strong><i class="fas fa-check-circle"></i> Accepted On:</strong> ${workshop.acceptedAt}</p>` : ''}
            </div>
            <div class="card-footer">
              <!-- No actions currently defined -->
            </div>
          </div>
        `).join('');
      } else {
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-chalkboard" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
            <p>You don't have any workshops yet.</p>
            <a href="/customer/workshop"><button class="btn primary"><i class="fas fa-plus-circle"></i> Book Workshop</button></a>
          </div>
        `;
      }
    }
  </script>

  <!-- // new script  -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Tab switching functionality
      const tabButtons = document.querySelectorAll('.tab-btn');
      const tabContents = document.querySelectorAll('.tab-content');

      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          // Remove active class from all buttons and contents
          tabButtons.forEach(btn => btn.classList.remove('active'));
          tabContents.forEach(content => content.classList.remove('active'));

          // Add active class to clicked button and corresponding content
          button.classList.add('active');
          const tabId = button.getAttribute('data-tab');
          document.getElementById(tabId).classList.add('active');
        });
      });
    });
  </script>
</body>

</html>