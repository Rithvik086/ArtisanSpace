<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order Details - ArtisanSpace</title>
  <link rel="stylesheet" href="/navbar2.css" />
  <link rel="stylesheet" href="/footer.css" />
  <style>
    :root {
      --primary-color: #5c6bc0;
      --secondary-color: #7986cb;
      --accent-color: #3949ab;
      --light-gray: #f5f5f5;
      --dark-gray: #616161;
      --text-color: #333;
      --success-color: #4caf50;
      --warning-color: #ff9800;
      --danger-color: #f44336;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f8f9fa;
      color: var(--text-color);
    }

    main {
      max-width: 1200px;
      margin: 30px auto;
      padding: 20px;
      background: white;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
    }

    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 20px;
      border-bottom: 1px solid #eee;
      margin-bottom: 30px;
    }

    .order-id {
      font-size: 1.5rem;
      color: var(--primary-color);
      font-weight: bold;
    }

    .order-date {
      color: var(--dark-gray);
    }

    .order-status {
      margin-top: 10px;
    }

    .status-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .pending {
      background-color: #fff3e0;
      color: #e65100;
    }

    .processing {
      background-color: #e3f2fd;
      color: #0d47a1;
    }

    .shipped {
      background-color: #e8f5e9;
      color: #1b5e20;
    }

    .delivered {
      background-color: #e8f5e9;
      color: #1b5e20;
    }

    .cancelled {
      background-color: #ffebee;
      color: #b71c1c;
    }

    .order-sections {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 30px;
    }

    .order-details,
    .customer-details {
      padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .section-title {
      font-size: 1.25rem;
      color: var(--primary-color);
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }

    .order-items {
      margin-bottom: 30px;
    }

    .item {
      display: grid;
      grid-template-columns: 100px 1fr 120px 120px;
      gap: 15px;
      align-items: center;
      padding: 15px 0;
      border-bottom: 1px solid #eee;
    }

    .item:last-child {
      border-bottom: none;
    }

    .item-image {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 4px;
    }

    .item-name {
      font-weight: 600;
    }

    .item-seller {
      color: var(--dark-gray);
      font-size: 0.9rem;
      margin-top: 5px;
    }

    .item-price,
    .item-quantity,
    .item-total {
      text-align: right;
      font-weight: 600;
    }

    .order-summary {
      margin-top: 30px;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
    }

    .summary-row.total {
      border-top: 2px solid #eee;
      border-bottom: none;
      padding-top: 15px;
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--primary-color);
    }

    .customer-info {
      margin-bottom: 30px;
    }

    .info-row {
      display: flex;
      margin-bottom: 10px;
    }

    .info-label {
      width: 120px;
      font-weight: 600;
      color: var(--dark-gray);
    }

    .info-value {
      flex: 1;
    }

    .shipping-address {
      padding: 15px;
      background-color: var(--light-gray);
      border-radius: 4px;
      margin-bottom: 30px;
    }

    .address-title {
      font-weight: 600;
      margin-bottom: 10px;
    }

    .payment-info {
      padding: 15px;
      background-color: var(--light-gray);
      border-radius: 4px;
    }

    .action-buttons {
      margin-top: 30px;
      display: flex;
      justify-content: flex-end;
      gap: 15px;
    }

    .btn {
      padding: 10px 20px;
      border-radius: 4px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .primary-btn {
      background-color: var(--primary-color);
      color: white;
    }

    .primary-btn:hover {
      background-color: var(--accent-color);
    }

    .outline-btn {
      background-color: transparent;
      border: 1px solid var(--primary-color);
      color: var(--primary-color);
    }

    .outline-btn:hover {
      background-color: var(--light-gray);
    }

    #update-status-form {
      margin-top: 20px;
      display: flex;
      gap: 10px;
    }

    #status-select {
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid #ddd;
      background-color: white;
    }

    .tracking-info {
      margin-top: 20px;
      padding: 15px;
      background-color: var(--light-gray);
      border-radius: 4px;
    }

    @media (max-width: 768px) {
      .order-sections {
        grid-template-columns: 1fr;
      }

      .item {
        grid-template-columns: 80px 1fr;
      }

      .item-price,
      .item-quantity {
        grid-column: 2;
        text-align: left;
      }

      .item-total {
        grid-column: 1/3;
        text-align: right;
        margin-top: 10px;
      }
    }
  </style>
</head>

<body>
  <%- include('../partials/navbar2', { role }) %>

  <main>
    <div class="order-header">
      <div>
        <h1 class="order-id">Order #<%= order._id.toString().slice(-6).toUpperCase() %></h1>
        <div class="order-date">Placed on <%= new Date(order.purchasedAt).toLocaleDateString('en-IN', { day: 'numeric', month: 'long', year: 'numeric' }) %></div>
        <div class="order-status">
          <span class="status-badge <%= order.status.toLowerCase() %>"><%= order.status %></span>
        </div>
      </div>
    </div>

    <div class="order-sections">
      <div class="order-details">
        <h2 class="section-title">Order Items</h2>
        <div class="order-items">
          <% order.products.forEach(product => { %>
          <div class="item">
            <img src="<%= product.productId.image %>" alt="<%= product.productId.name %>" class="item-image">
            <div class="item-info">
              <div class="item-name"><%= product.productId.name %></div>
              <div class="item-seller">Category: <%= product.productId.category %></div>
              <div class="item-seller">Material: <%= product.productId.material %></div>
            </div>
            <div class="item-price">₹<%= product.productId.newPrice %></div>
            <div class="item-quantity">Qty: <%= product.quantity %></div>
          </div>
          <% }); %>
        </div>

        <div class="order-summary">
          <h2 class="section-title">Order Summary</h2>
          <% 
            // Calculate subtotal, tax, and shipping
            const subtotal = order.products.reduce((acc, product) => {
              return acc + (product.productId.newPrice * product.quantity);
            }, 0);
            const shipping = 50; // Fixed shipping fee
            const tax = Math.round(subtotal * 0.05 * 100) / 100; // 5% tax
            const total = order.money; // Total from DB
          %>
          <div class="summary-row">
            <span>Subtotal</span>
            <span>₹<%= subtotal.toFixed(2) %></span>
          </div>
          <div class="summary-row">
            <span>Shipping</span>
            <span>₹<%= shipping.toFixed(2) %></span>
          </div>
          <div class="summary-row">
            <span>Tax (5%)</span>
            <span>₹<%= tax.toFixed(2) %></span>
          </div>
          <div class="summary-row total">
            <span>Total</span>
            <span>₹<%= total.toFixed(2) %></span>
          </div>
        </div>
      </div>

      <div class="customer-details">
        <div class="customer-info">
          <h2 class="section-title">Customer Information</h2>
          <div class="info-row">
            <span class="info-label">Name:</span>
            <span class="info-value"><%= order.userId.name %></span>
          </div>
          <div class="info-row">
            <span class="info-label">Username:</span>
            <span class="info-value"><%= order.userId.username %></span>
          </div>
          <div class="info-row">
            <span class="info-label">Email:</span>
            <span class="info-value"><%= order.userId.email %></span>
          </div>
          <div class="info-row">
            <span class="info-label">Phone:</span>
            <span class="info-value"><%= order.userId.mobile_no || 'N/A' %></span>
          </div>
        </div>

        <div class="shipping-info">
          <h2 class="section-title">Shipping Information</h2>
          <div class="shipping-address">
            <div class="address-title">Delivery Address</div>
            <% 
              let addressParts = [];
              if (order.userId.address) {
                // Split address by | character
                addressParts = order.userId.address.split('|').map(part => part.trim());
                
                // Format the address parts with labels
                const addressLabels = {
                  0: 'Building/House:',
                  1: 'Street/Area:',
                  2: 'City:',
                  3: 'State:',
                  4: 'Pincode:',
                  5: 'Country:'
                };
              %>
            <% addressParts.forEach((part, index) => { %>
            <div class="info-row">
              <span class="info-label"><%= addressLabels[index] || '' %></span>
              <span class="info-value"><%= part %></span>
            </div>
            <% }); %>
            <% } %>
          </div>

          <% if (order.status === 'shipped' || order.status === 'delivered') { %>
          <div class="tracking-info">
            <div class="address-title">Tracking Information</div>
            <div class="info-row">
              <span class="info-label">Carrier:</span>
              <span class="info-value"><%= order.tracking?.carrier || 'Standard Shipping' %></span>
            </div>
            <div class="info-row">
              <span class="info-label">Tracking #:</span>
              <span class="info-value"><%= order.tracking?.number || 'N/A' %></span>
            </div>
          </div>
          <% } %>
        </div>

        <div class="payment-info">
          <h2 class="section-title">Payment Information</h2>
          <div class="info-row">
            <span class="info-label">Method:</span>
            <span class="info-value"><%= order.paymentMethod || 'Cash on Delivery' %></span>
          </div>
          <div class="info-row">
            <span class="info-label">Status:</span>
            <span class="info-value"><%= order.paymentStatus || 'Pending' %></span>
          </div>
        </div>
      </div>
    </div>

    <div class="action-buttons">
      <button class="btn outline-btn" id="print-btn" onclick="window.print()">Print Invoice</button>
      <button class="btn outline-btn" id="back-btn" onclick="window.history.back()">Back</button>
    </div>
  </main>

  <%- include('../partials/footer') %>

</body>

</html>